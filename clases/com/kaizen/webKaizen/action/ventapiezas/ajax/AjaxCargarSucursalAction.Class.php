<?phpclass AjaxCargarSucursalAction extends SecureAjaxAction {	protected $path_html;	protected $class;	protected $required;	protected $funcion ="";	/**	 * se elimina de sesi�n la pieza seleccionada.	 */	public function executeImpl() {		if (isset($_GET ['cd_pieza1'])) {			$cd_pieza = $_GET ['cd_pieza1'];		}				$this->setPath_html('ventaspiezas/ajax/ajax_cargarsucursal.html');								$xtpl = new XTemplate(APP_PATH . $this->getPath_html());		$this->parseSucursales($xtpl, $cd_pieza);				//seteamos la funci�n de "onchange" en caso de que se haya indicado una.		if (!empty($this->onchange)) {			$xtpl->assign('onchange', "javascript:" . $this->onchange . ";");		}		if (!empty($this->class)) {			$xtpl->assign('class', "$this->class");		}		if ($this->required) {			$xtpl->assign('required', "(*)");		}						$xtpl->assign('WEB_PATH', WEB_PATH);		$xtpl->parse('main');		$texto = $xtpl->text('main');		return $texto;	}		protected function parseSucursales(XTemplate $xtpl, $cd_pieza) {        $criterio = new CriterioBusqueda();		$cd_pieza=($cd_pieza)?$cd_pieza:0;        $criterio->addFiltro('SP.cd_pieza', $cd_pieza, "=");		$criterio->addOrden('S.ds_nombre');		$sucursalManager = new SucursalManager();        $sucursales = $sucursalManager->getSucursalesPorStockPieza($criterio);		$manager = new UsuarioKaizenManager();		$oUsuario = $manager->getUsuarioPorId( $_SESSION['cd_usuarioSession'] );		        foreach ($sucursales as $key => $sucursal) {			if (($oUsuario->getCd_perfil()==1)||($oUsuario->getCd_sucursal()==$sucursal->getCd_sucursal())) {				$xtpl->assign('ds_sucursal', $sucursal->getDs_nombre());	            $xtpl->assign('cd_sucursal', FormatUtils::selected($sucursal->getCd_sucursal(), $cd_selected));		            $xtpl->parse('main.option_sucursal1');			}                    }        		        }	public function getFuncion() {		if($this->funcion == ""){			return "Alta Venta";		}else{			return $this->funcion;		}	}			public function setFuncion($value){		$this->funcion = $value;	}	public function getPath_html() {		return $this->path_html;	}	public function getClass() {		return $this->class;	}	public function getRequired() {		return $this->required;	}	/*	 * setea el value para onchange del combo.	 */	public function setPath_html($value) {		$this->path_html = $value;	}	public function setOnchange($value) {		$this->onchange = $value;	}	public function setClass($value) {		$this->class = $value;	}	public function setRequired($value) {		$this->required = $value;	}}